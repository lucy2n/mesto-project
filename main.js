(()=>{"use strict";var e=document.querySelector(".image-popup"),t=e.querySelector(".popup__caption"),n=e.querySelector(".popup__image"),o=null,r=function(e){"Escape"==e.key&&c(o)},c=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)},u=function(e){o=e,e.classList.add("popup_opened"),document.addEventListener("keydown",r)},a=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},i={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-21",headers:{authorization:"5832d533-117d-41c2-950f-4a452b9fc5a1","Content-Type":"application/json"}},s=document.querySelector(".elements"),l=function(o,r){var c=function(o,r){var c=document.querySelector("#card-template").content.querySelector(".element").cloneNode(!0),a=c.querySelector(".element__trash-button"),s=c.querySelector(".element__like-button"),l=c.querySelector(".element__like-count");o.likes.some((function(e){return e._id==r}))&&s.classList.add("element__like-button_active"),s.addEventListener("click",(function(e){var t;e.target.classList.toggle("element__like-button_active"),e.target.classList.contains("element__like-button_active")?(t=o._id,fetch("".concat(i.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){l.textContent=Number(l.textContent)+1,console.log(e)})):function(e){return fetch("".concat(i.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))}(o._id).then((function(e){l.textContent=Number(l.textContent)-1,console.log(e)}))})),a.classList.add("element__trash-button_disabled"),r==o.owner._id&&a.classList.remove("element__trash-button_disabled"),a.addEventListener("click",(function(){var e;(e=o._id,fetch("".concat(i.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){c.remove(),console.log(e)}))}));var d=c.querySelector(".element__image");return l.textContent=o.likes.length,d.src=o.link,d.alt=o.name,d.addEventListener("click",(function(){var r,c;r=o.name,c=o.link,t.textContent=r,n.src=c,n.alt=r,u(e)})),c.querySelector(".element__title").textContent=o.name,c}(o,r);s.prepend(c)},d=function(e,t){t.querySelector(".popup__submit-button").textContent=e?"Сохранение...":"Сохранить"},f=document.querySelector(".content"),p=document.querySelector("#popup-edit"),m=document.querySelector("#popup-add"),h=document.querySelector("#popup-avatar"),_=document.querySelectorAll(".popup__close-button"),v=p.querySelector(".popup__container"),y=v.querySelector("#name-input"),S=v.querySelector("#subline-input"),b=f.querySelector(".profile"),q=b.querySelector(".profile__edit-button"),k=b.querySelector(".profile__add-button"),L=b.querySelector(".profile__edit-avatar-button"),C=b.querySelector(".profile__name"),E=b.querySelector(".profile__author-subline"),g=b.querySelector(".profile__avatar"),j=h.querySelector(".popup__container"),x=m.querySelector(".popup__container"),P=x.querySelector("#name-card-input"),U=x.querySelector("#link-card-input"),T=null;_.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){c(t)})),t.addEventListener("click",(function(e){e.target.classList.contains("popup")&&c(e.currentTarget)}))}));var A;q.addEventListener("click",(function(){u(p),y.value=C.textContent,S.value=E.textContent})),v.addEventListener("submit",(function(e){var t,n;e.preventDefault(),d(!0,v),(t=y.value,n=S.value,fetch("".concat(i.baseUrl,"/users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){C.textContent=e.name,E.textContent=e.about})).finally((function(){d(!1,v),c(p)}))})),k.addEventListener("click",(function(){u(m)})),L.addEventListener("click",(function(){u(h)})),x.addEventListener("submit",(function(e){var t,n;e.preventDefault(),d(!0,m),(t=P.value,n=U.value,fetch("".concat(i.baseUrl,"/cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){l(e,T)})).finally((function(){d(!1,m),c(m)})),x.reset()})),j.addEventListener("submit",(function(e){var t;e.preventDefault(),d(!0,h),(t=document.querySelector("#link-avatar-input").value,fetch("".concat(i.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)}))).then((function(e){g.src=e.avatar})).finally((function(){d(!1,h),c(h)})),j.reset()})),fetch("".concat(i.baseUrl,"/users/me"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)})).then((function(e){C.textContent=e.name,E.textContent=e.about,g.src=e.avatar,T=e._id,fetch("".concat(i.baseUrl,"/cards"),{headers:i.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e})).catch((function(e){return console.log(e)})).then((function(e){e.reverse(),console.log(e),e.forEach((function(e){l(e,T)}))}))})),A={formSelector:".popup__container",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},Array.from(document.querySelectorAll(A.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);a(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){a(n,o,t)}),0)})),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),a(n,o,t)}))}))}(e,A)}))})();